{% extends 'base.html' %}
{% block content %}
<style>
    /* General Styling */
    body {
        font-family: Arial, sans-serif;
        background-color: #f4f4f4;
        margin: 0;
        padding: 0;
    }

    .container {
        max-width: 800px;
        margin: 50px auto;
        padding: 20px;
        background-color: #fff;
        border-radius: 8px;
    }

    h1, h2 {
        text-align: center;
        color: #333;
        margin-bottom: 30px;
    }

    /* List Styling */
    #results-list {
        list-style-type: none;
        padding: 0;
    }

    #results-list li {
        padding: 15px;
        border-bottom: 1px solid #ddd;
        display: flex;
        align-items: center;
        justify-content: space-between;
    }

    .fighter {
        display: flex;
        align-items: center;
    }

    .fighter-name {
        font-weight: bold;
        margin: 0 10px;
    }

    .score-text, .score-input {
        width: 60px;
        text-align: center;
        margin: 0 10px;
    }

    .score-input {
        display: none;
    }

    /* Buttons */
    .btn {
        display: inline-block;
        font-weight: 400;
        color: #fff;
        background-color: #007bff;
        border: none;
        padding: 10px 20px;
        margin: 5px 2px;
        text-decoration: none;
        border-radius: 4px;
        font-size: 16px;
        cursor: pointer;
    }

    .btn-primary {
        background-color: #007bff;
    }

    .btn-success {
        background-color: #28a745;
    }

    .btn-link {
        background-color: transparent;
        color: #007bff;
        text-decoration: none;
        padding: 0;
        border: none;
        font-size: 16px;
    }

    .btn-link:hover {
        text-decoration: underline;
        color: #0056b3;
    }

    /* Responsive Design */
    @media (max-width: 768px) {
        .container {
            margin: 20px auto;
            padding: 15px;
        }

        h1, h2 {
            font-size: 1.5em;
        }

        #results-list li {
            flex-direction: column;
            align-items: flex-start;
        }

        .fighter {
            margin-bottom: 10px;
        }

        .fighter-name, .score-text, .score-input {
            margin: 5px 0;
        }

        .btn {
            width: 100%;
            margin: 10px 0;
        }
    }

    @media (max-width: 576px) {
        h1, h2 {
            font-size: 1.2em;
        }

        .btn {
            font-size: 18px;
            padding: 12px;
        }
    }
</style>

<div class="container">
    <h1>Тренировка: {{ session }}</h1>
    <h2>Результаты</h2>
    <ul id="results-list">
        {% for info in results %}
            <li data-result="{{ info }}">
                <div class="fighter">
                    <span class="fighter-name">{{ info.split()[0] }}</span>
                    <span class="score-text">{{ info.split()[1] }}</span>
                    <input type="number" class="score-input" value="{{ info.split()[1] }}" min="0">
                </div>
                <div class="fighter">
                    <span class="score-text">{{ info.split()[3] }}</span>
                    <input type="number" class="score-input" value="{{ info.split()[3] }}" min="0">
                    <span class="fighter-name">{{ info.split()[4] }}</span>
                </div>
            </li>
        {% endfor %}
    </ul>
    <button class="btn btn-primary" id="edit-btn">Редактировать</button>
    <button class="btn btn-success" id="save-btn" style="display:none;">Сохранить</button>
    <a href="{{ url_for('list_sessions') }}" class="btn btn-link">К историям тренировок</a>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const resultsList = document.getElementById('results-list');
    const editBtn = document.getElementById('edit-btn');
    const saveBtn = document.getElementById('save-btn');

    editBtn.addEventListener('click', function() {
        const scoreTexts = document.querySelectorAll('.score-text');
        const scoreInputs = document.querySelectorAll('.score-input');

        scoreTexts.forEach(text => text.style.display = 'none');
        scoreInputs.forEach(input => {
            // Store the old score in a data attribute
            input.dataset.oldScore = input.value;
            input.style.display = 'inline';
        });

        editBtn.style.display = 'none';
        saveBtn.style.display = 'inline';
    });

    saveBtn.addEventListener('click', function() {
        const scoreTexts = document.querySelectorAll('.score-text');
        const scoreInputs = document.querySelectorAll('.score-input');

        scoreTexts.forEach((text, index) => {
            text.textContent = scoreInputs[index].value;
            text.style.display = 'inline';
            scoreInputs[index].style.display = 'none';
        });

        editBtn.style.display = 'inline';
        saveBtn.style.display = 'none';

        // Collect updated scores along with old scores
        const updatedResults = [];
        resultsList.querySelectorAll('li').forEach(li => {
            const fighterNames = li.querySelectorAll('.fighter-name');
            const scoreInputs = li.querySelectorAll('.score-input');

            const fighter1 = fighterNames[0].textContent.trim();
            const oldScore1 = scoreInputs[0].dataset.oldScore.trim();
            const newScore1 = scoreInputs[0].value.trim();

            const fighter2 = fighterNames[1].textContent.trim();
            const oldScore2 = scoreInputs[1].dataset.oldScore.trim();
            const newScore2 = scoreInputs[1].value.trim();

            updatedResults.push({
                fighter1: fighter1,
                oldScore1: oldScore1,
                newScore1: newScore1,
                fighter2: fighter2,
                oldScore2: oldScore2,
                newScore2: newScore2
            });
        });

        // Send updated results to server via AJAX
        fetch(`/sessions/{{ session }}/update`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ results: updatedResults }),
        })
        .then(response => response.json())
        .then(data => {
            console.log('Success:', data);
            // Optionally, display a success message or update the page
        })
        .catch((error) => {
            console.error('Error:', error);
            // Optionally, display an error message to the user
        });
    });
});
</script>

{% endblock %}
